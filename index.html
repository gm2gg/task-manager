<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

</head>
<body>
  <h2>–ê–≤—Ç–æ—Ä S_GM</h2>
  <h1>üåç–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ —Å —Ä—É—Å—Å–∫–æ–≥–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–πüåç</h1>
  <input type="text" id="russian_word" placeholder="–ß—Ç–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏?">
  <button id="translateBtn">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
  <div id="result"></div>
  <div id="userInfo">ID: –∑–∞–≥—Ä—É–∑–∫–∞...</div>
  <style>
    body {
      background-color: #AFEEEE;
      border-radius: 8px;
      display: flex;
      flex-direction: column; /* —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∫–æ–ª–æ–Ω–∫—É */
      align-items: center;    /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
      justify-content: center;/* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
      min-height: 100vh;      /* –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞ */
    }

/* –î–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
h1 {
  font-size: 24px;
  margin-bottom: 30px;
}

h2 {
    font-family: 'Courier New', monospace;
    font-size: 14px;
    color: #666;
    letter-spacing: 2px;
    text-transform: uppercase;
    text-align: right; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
    margin: 0 20px 20px 0; /* –û—Ç—Å—Ç—É–ø—ã: —Å–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞ —Å–Ω–∏–∑—É —Å–ª–µ–≤–∞ */
}

/* –î–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ */
#russian_word {
  padding: 12px 15px;
  font-size: 16px;
  width: 250px;
  margin-bottom: 20px;
}

/* –î–ª—è –∫–Ω–æ–ø–∫–∏ */
#translateBtn {
  padding: 16px 48px;
  font-size: 16px;
}

/* –î–ª—è –±–ª–æ–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
#result {
  font-size: 30px;
  margin-top: 24px;
  min-height: 30px;
  padding: 10px;
}
#userInfo {
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
}
  </style>
<script>
let currentUserId = null;
let userData = {
    originalText: '',
    translatedText: ''
};

// üì± –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø Telegram Web App
function initTelegramApp() {
    const tg = window.Telegram.WebApp;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ Telegram Web App
    if (tg.initData) {
        tg.expand();
        const user = tg.initDataUnsafe.user;

        if (user && user.id) {
            currentUserId = user.id;
            console.log('User ID:', currentUserId);
            document.getElementById('userInfo').textContent = `ID: ${currentUserId}`;
            loadUserData();
            return; // –í—ã—Ö–æ–¥–∏–º, –µ—Å–ª–∏ –Ω–∞—à–ª–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        }
    }

    // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –∑–Ω–∞—á–∏—Ç –ù–ï –≤ Telegram Web App
    console.log('–†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ –≤ Telegram)');
    currentUserId = 'test_user_' + Math.random().toString(36).substr(2, 9);
    document.getElementById('userInfo').textContent = `ID: ${currentUserId} (—Ç–µ—Å—Ç)`;
    document.getElementById('userInfo').style.background = '#ff9900'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è —Ç–µ—Å—Ç–∞
}

// üíæ –§–£–ù–ö–¶–ò–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–•
async function saveUserData() {
    if (!currentUserId) return;

    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    const dataToSave = {
        original_text: userData.originalText,
        translated_text: userData.translatedText
    };

    try {
        // üì§ –û–¢–ü–†–ê–í–õ–Ø–ï–ú –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        const response = await fetch('/save_data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(dataToSave)
        });

        if (response.ok) {
            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }
    } catch (error) {
        console.log('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
    }
}

// üì• –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –î–ê–ù–ù–´–•
async function loadUserData() {
    if (!currentUserId) return;

    try {
        // üì• –ü–û–õ–£–ß–ê–ï–ú –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
        const response = await fetch('/get_data');
        const data = await response.json();

        // üî• –ò–°–ü–†–ê–í–ò–¢–¨ –≠–¢–£ –ß–ê–°–¢–¨:
        if (data.success && data.all_user_data) {  // ‚Üê –±—ã–ª–æ data.user_data
            // üéâ –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¢–ï–ö–£–©–ï–ì–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userDataFromServer = data.all_user_data[currentUserId] || {};

            userData.originalText = userDataFromServer.original_text || '';
            userData.translatedText = userDataFromServer.translated_text || '';

            // üñäÔ∏è –ó–ê–ü–û–õ–ù–Ø–ï–ú –ø–æ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            document.getElementById('russian_word').value = userData.originalText;
            document.getElementById('result').textContent = userData.translatedText;

            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', userData);
        }
    } catch (error) {
        console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
    }
}

// üîÑ –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–í–û–î–ê
async function translateWord() {
    const text = document.getElementById('russian_word');  // ‚úÖ –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç
    const result = document.getElementById('result');      // ‚úÖ –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç

    if (text.value.trim() === '') {
        return;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
    userData.originalText = text.value;

    // 1. –î–µ–ª–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥
    const response = await fetch(`https://api.mymemory.translated.net/get?q=${userData.originalText}&langpair=ru|en`);
    const data = await response.json();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥
    userData.translatedText = data.responseData.translatedText;
    result.textContent = userData.translatedText;

    // üíæ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –°–û–•–†–ê–ù–Ø–ï–ú –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞
    saveUserData();
}

// üèÅ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
document.addEventListener('DOMContentLoaded', function() {
    // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const text = document.getElementById('russian_word');
    const result = document.getElementById('result');
    const button = document.getElementById('translateBtn');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App
    initTelegramApp();

    // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
    button.addEventListener('click', translateWord);

    // üíæ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    text.addEventListener('input', function() {
        userData.originalText = text.value;
        // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø–æ —Ç–∞–π–º–µ—Ä—É
    });
});
</script>
</body>
</html>
